FPulseHelp.txt - Mini help for FPulse
---------------------------------------------------------------------------------------------------------------------------
// 2010-02-01 improved code allowing arbitrary Dac output value during NoStore periods
// Version1 (fixed value is not good, but could be user settable) :  The amplitude for any dac during all NoStore periods is this hard-coded value 'BlankAmp'  (only the value 0 is useful)
// Version2 ( preferable )  :  The amplitude applied during the NoStore period is (for any dac) the last value of the preceding Store period ( 1 data point = duration of 1 sample interval) is sufficient


Todo:
			Conversion 34
				Bugs:  Pon   Ramp   Stimdisplay???

// Syntax:  [ Dig =   Ch,   Dur,   Del,   DDur,   DDel ]
// Syntax: Segment/Blank..  :	Dac =   Ch,   Dur,   A/R,  Del ;      Amp	 =  	Amp,   Scl,   DAmp,   DDur
// Syntax: Stimwave		:	Dac =   Ch,   Dur,   A/R,  Del ;      Wave	 = 	wave file name,   scl, ofs, sclX 
// Syntax: Expo		old	:	Dac =   Ch,   Dur,   A/R,  Del ;      AmpTau=	Amp1,   TauRise1,   TauDecay1,   deltaT1,   Scl1 / Amp2,   TauRise2,   TauDecay2,   deltaT2,   Scl2 / ...

				Dig 		new:	Dig= ,  DigDur= ,  DigDel= ,  DigDDur= ,  DigDDel=  ,  
				Expo   	new:	Amp : Trise : Tdec :  DeltaT :  SclY /  ......same for second expo
				Sine 	new:	Amp : Periods :  // ???? better: keywords ?   Freq : ignored ?? Phase : Ofs
				Stimwave new : 	Name=, scl=, ofs=, sclX=
				Amp old:		Amp, ScalA, DAm, (DDu)
				Ramp old:		Amp=EndVal, ScalA, (DAm, DDu)     neu: BegVal, EndVal
	
			Ask : delete from list if  path not found  (deletes but does not ask)

			channel name should contain number e.g. WithTg6(1) 
			the average traces prevent the time scale to shrink (should be ~ nPtsSv)
			Issue warning if this help file to be closed without saving changes
			Issue warning if there is no 'newds' specifier in script  or  print Data section count

Notes/Manual:

Pitfalls:
Version 3 script files are converted semi-automatically to the Version 4 syntax (some minor manual may be required).
Before attempting to convert Version 3 script files you should copy them to a Backup directory, as they will be overwritten during the conversion.

If the stimulus display does not show the expected stimulus then try to display it in 'HiRes' mode.  
Also turn on all Blocks,  turn on laps, and swittch between 'No store' on and off.
Note that there will always be only 1 frame displayed even if multiple frame are specified in the script. In Version 3 there was the possibility to display just 1 or multiple frames.

There must be short 'Store' sections around 'NoStore' sections defining the desired Dac output value during the 'NoStore' period.
In principle 1 sample interval is sufficient, but slightly longer sections are preferable for 2 reasons:
- they are better recognised in the stimulus display on screen
- The entire protocol duration (all sample points of 1 script) is decomposed into primes the facilitate mapping into the Ced memory.
If the script had 10000 point before and only 2 points are added the length will be 10002 (=2x3x1667).
If 10 points were added the length will be 10010 (=2x5x7x11x13) which allows better memory mapping.
Of course the best solution would be to make the Nostore section somewhat shorter that after adding the short 'Store' sections the script still has 10000 sample points.  Generally speaking 'bad' numbers of data points will also be processed but at the expense of longer script loading times and more data transfer between Ced and computer (because more telegraph data than principally necessary must be transferred).

There must be a short Nostore section at the end of a script (with Dac output 0), if the last Dac output is not zero.
If this  Nostore section section is missing, the last non-zero Dac value will persist about 100ms longer than desired before it returns to the final value 0.
 			
The acquisition in hardware-triggered E3E4 mode will not be permanently stopped when the 'Stop/Finish' button is pressed. 
Only the current protocol will beinterrupted but the next trigger pulse will start a new acquisition.
This is in contrast to the normal trigger mode using the 'Start' button.
The acquisition in hardware-triggered E3E4 mode can be permanently stopped by switching to the normal 'Start button' trigger mode.

When using the FPulse versions 3 and 4 in parallel (e.g. to verify that the scripts converted from V3 to V4 work as expected) some precautions must be observed:
- always use the normal 'Start button' trigger mode, never use the hardware-triggered E3E4 mode
- after switching to the other version 'Reload' or 'Apply' the script before starting it.
- observe the Dac output on the oscilloscope 
- when the script does not behave as expected and the computer seems to get out of control you can try to use the emergency options in the CED1401 panel: Reset 1401  and  Stop background task.  Igor's Abort button on the bottom left of the Igor window will rarely help in this situation.
Note that stopping the background task should be used only as a last resort to recover from a hanging system. The acquisition process blocking the system will be brutely interrupted resulting in the loss of all acquired data.


			PoverN:	 Immediately before and after the PoN loop there must be a 'NewDs' segment.
					Of course in the  PoN loop there must also be a 'NewDs' segment, usually this is the first segment. 
			Options -> CFS header Information: 'Header short' displays data section information only for the first sweep of each frame
			Expo parameters: Amp, Trise, Tdec DeltaT, ScaleY
			Display stimulus: uppermost traces display NewDs (a newds is started on every CHANGE)
							below uppermost the stored periods are displayed (stored = visible line)

Design issues:

PoN (Dac):	Only if PoN is specified in the DAC line  AND  within a block/frame  the correction 
			segments arre inserted in this Block/Frame for this channel.
			Other non-pon channels process the pon-block/frame by looping pon+1 times through these
			segments (same timing as pon-channel but neither correction scaling not correction polarity inversion 
PoN (Adc):	Is currently (2009-Dec) ignored.  If Pon is specified for a Block/Frame then the 
			corrected sweep is inserted for ALL adc channels independent of their Pon settings.


2009-12-15	nostore segment are drawn as empty ranges in the stimulus plot if 'no store'
			is checked even if there is a DAC output voltage specified for this segment. 
			Improvement: Draw dac output but in different color.

---------------------------------------------------------------------------------------------------------------------------
How to make an Online Analysis

- Load a script file

- If no acquisition window opens you have not yet saved a display configuration
	Run the script perhaps with just 1 frame (to save time) 
	Configure the acquisition window(s) to your need
	Save the display configuration

- Set the evaluation parameters for each channel 
	e.g. set peak direction up or down, set number of averaged peak points (Pts1side)
	turn fitting on or off

- Check the 'OA selection' checkbox .  The OLA result listbox opens.


- Define the evaluation region by dragging a marquee rectangle in the acquisition window
	Your selection will appear in the OLA results listbox in A and window A opens
	To do : all, not only base and peak
	To do : let the user select Window B and C

- Start an acquisition
	todo: the online results should appear immediately, but they appear only after 
	click / shift click in the listbox
	
-----------------------------------------------------------------------------------------------------------------------------	
The Acq Display Listbox
	- left clicking into a window column will display the selected trace (e.g. Dac0, Adc2..) 
		in the selected window (e.g. W0, W1, W2) 
		using the selected mode (C = current, M = many superimposed)
		and the selected range (Sweeps, Frames, Primary=Sweep0 or Result (only for PoverN) )
		and will use the same Y axis as the preceding trace
	- left clicking into a window column with the ALT key pressed will also display the selected trace (e.g. Dac0, Adc2..) 
		in the selected window (e.g. W0, W1, W2) 
		using the selected mode (C = current, M = many superimposed)
		and the selected range (Sweeps, Frames, Primary=Sweep0 or Result (only for PoverN) )
		but will construct a new Y axis for the trace
	- left clicking into a window column while holding the SHIFT key down will remove the trace
	- right clicking into a window column will display the control bar which allows
		adjustment of Y zoom factor, Y offset, trace color and  Autoscaling.
	- right clicking into a window column while holding the SHIFT key down will remove the control bar

-----------------------------------------------------------------------------------------------------------------------------	
		 	